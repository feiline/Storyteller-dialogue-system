# Storyteller Dialogue System

Conversational AI: MSc project to design, develop and evaluate a conversational story-teller dialogue system.

***

## Libraries
The system is developed and tested using Python 3.7. Some of the libraries required are:
- DM `nltk`
- NLG
- NLU `rasa, tensorflow, re`
- bot `telepot, flask, logging, argparser`
- fsm `transitions`
- web interface

## How To

#### Installation
- Create environment with conda/mamba

  ```bash
  conda create -c conda-forge -n storyteller python=3.7
  conda activate storyteller
  ```
- install the requirements `pip install -r requirements.txt`
- reinstall setuptools to avoid an error: `pip install -U pip setuptools`
- set up rasa

```bash
cd storyteller-dialogue-system
rasa init --init-dir rasa_nlu
```

Do not train the default model. Use the specified settings to train the model:

```bash
rasa train nlu --config rasa_nlu/config.yml --nlu rasa_nlu/data/nlu.md --out rasa_nlu/models
```

Untar the trained model under the `rasa_nlu/models`

```bash
cd rasa_nlu/models
tar xvf <model_date-model_time>.tar.gz
```

- download NLTK data. Run in python

```python
import nltk
nltk.download('stopwords')
nltk.download('twitter_samples')
nltk.download('averaged_perceptron_tagger')
nltk.download('wordnet')
nltk.download('punkt')
```
Move the NLTK data dir under your environment path (optional):

```bash
mv ~/nltk_data /path/to/env/share/nltk_data
```

#### Set up the Telegram interface
- Create a Telegram bot following the steps given by the BotFather bot (you can follow this tutorial: https://core.telegram.org/bots#6-botfather) 
- Modify the `credentials.py` file with your bot name and bot token

#### Set up your local machine as server
- Registered to Ngrok from `https://ngrok.com/`
- Go to https://dashboard.ngrok.com/get-started to download the ngrok client
- Unzip the folder
- From the unzipped folder, run the command `./ngrok authtoken xxxxxxxxxxxxxxas` that appears for you on that link
- Run `./ngrok http 5130`
- If you are using the Telegram web interface, replace the `bot.setWebhook("https://******.ngrok.io/chat")` in `bot_telegram.py` with the https url generated by ngrok (leave the suffix `/chat` at the end)
- If you are using the Alana interface, please follow the Alana instruction on how to send requests to Alana.

#### Set up the application
- Select which engagement strategy to use: currently the system uses the baseline strategy. To use the Feedback Prompt strategy please comment `line 102` of `bot_telegram.py` and uncomment `line 103` of `bot_telegram.py`

#### Run the application
- Run `bot_telegram.py` to run the system using the Telegram web interface

---

The story used is the Squirrel story from the PersonaBank corpus [PersonaBank corpus](https://arxiv.org/pdf/1708.09082.pdf)
